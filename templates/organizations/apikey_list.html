{% extends 'base.html' %}

{% block title %}Chaves API - PanDia{% endblock %}
{% block page_title %}Chaves API{% endblock %}

{% block content %}
<div class="content-header">
    <div>
        <h1 class="content-title">Chaves API</h1>
        <p class="content-subtitle">Gerencie suas chaves API para integrações externas</p>
    </div>
    <a href="{% url 'organizations:apikey_create' %}" class="btn btn-primary">+ Criar Chave API</a>
</div>

{% if api_keys %}
    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
        {% for key in api_keys %}
        <div class="list-item">
            <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #fb923c, #f59e0b); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <svg width="20" height="20" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="list-item-title">{{ key.name }}</h3>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.25rem;">
                            <span class="list-item-meta">{{ key.padaria.name }}</span>
                            {% if key.agent %}
                                <span class="badge" style="background: #8b5cf6; color: white;">🤖 {{ key.agent.name }}</span>
                            {% else %}
                                <span class="badge" style="background: #6366f1; color: white;">🔓 Todos os agentes</span>
                            {% endif %}
                            {% if key.is_active %}
                                <span class="badge badge-success">Ativa</span>
                            {% else %}
                                <span class="badge" style="background: var(--gray-400); color: white;">Inativa</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div style="background: var(--gray-50); padding: 0.75rem; border-radius: 6px; font-family: monospace; font-size: 0.875rem; color: var(--gray-700); display: flex; align-items: center; justify-content: space-between;">
                    <code>{{ key.key }}</code>
                    <button onclick="copyKey('{{ key.key }}')" class="btn-icon" style="margin-left: 0.5rem;">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="list-item-actions">
                <a href="{% url 'organizations:apikey_delete' key.pk %}" class="btn-icon btn-icon-danger" title="Excluir">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <svg width="64" height="64" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
        </svg>
        <h3 class="empty-state-title">Nenhuma chave API ainda</h3>
        <p class="empty-state-text">Crie uma chave API para integrar com sistemas externos</p>
        <a href="{% url 'organizations:apikey_create' %}" class="btn btn-primary">Criar Chave API</a>
    </div>
{% endif %}

<script>
function copyKey(key) {
    navigator.clipboard.writeText(key).then(() => {
        alert('Chave API copiada para a área de transferência!');
    });
}
</script>
{% endblock %}
