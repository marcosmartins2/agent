{% extends 'base.html' %}

{% block title %}Nova API Key{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1>
            <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
            </svg>
            Criar Nova API Key
        </h1>
        <p style="color: var(--gray-600); font-size: 1.125rem; margin-top: var(--space-2);">Gere uma chave de API para integra√ß√£o com sua aplica√ß√£o</p>
    </div>
</div>

<div class="form-container">
    {% if new_key %}
    <div style="background: linear-gradient(135deg, rgba(209, 250, 229, 0.5), rgba(167, 243, 208, 0.3)); border: 2px solid var(--success); border-radius: var(--radius-2xl); padding: var(--space-8); animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);">
        <div style="text-align: center; margin-bottom: var(--space-8);">
            <h3 style="color: var(--success-dark); margin-bottom: var(--space-6); font-size: 1.5rem; display: flex; align-items: center; justify-content: center; gap: var(--space-2);">
                <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                API Key Criada com Sucesso!
            </h3>
            
            <p style="color: var(--gray-700); margin-bottom: var(--space-6); font-size: 1.0625rem;">
                <strong style="color: var(--danger);">‚ö†Ô∏è IMPORTANTE:</strong> Copie esta chave agora! Ela n√£o ser√° exibida novamente.
            </p>
            
            <code style="display: block; background: var(--gray-900); color: #f9a8d4; padding: var(--space-6); border-radius: var(--radius-xl); font-size: 1rem; letter-spacing: 1px; word-break: break-all; margin: var(--space-6) 0; font-family: 'Consolas', 'Monaco', monospace; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">{{ new_key }}</code>
        </div>

        <!-- Como usar -->
        <div style="background: white; padding: var(--space-6); border-radius: var(--radius-xl); margin-top: var(--space-6); border: 2px solid var(--beige-200);">
            <h4 style="color: var(--gray-900); font-size: 1.125rem; margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                </svg>
                Como usar no n8n
            </h4>
            
            <ol style="color: var(--gray-700); line-height: 1.8; margin-left: var(--space-6);">
                <li style="margin-bottom: var(--space-3);"><strong>No n8n:</strong> Adicione um n√≥ HTTP Request</li>
                <li style="margin-bottom: var(--space-3);"><strong>URL:</strong> <code style="background: var(--beige-100); padding: var(--space-1) var(--space-2); border-radius: var(--radius-md); font-size: 0.875rem;">{{ request.scheme }}://{{ request.get_host }}/api/chat/</code></li>
                <li style="margin-bottom: var(--space-3);"><strong>M√©todo:</strong> POST</li>
                <li style="margin-bottom: var(--space-3);"><strong>Headers:</strong>
                    <pre style="background: var(--gray-900); color: #f9a8d4; padding: var(--space-4); border-radius: var(--radius-lg); margin-top: var(--space-2); font-size: 0.875rem; overflow-x: auto;">Authorization: Bearer {{ new_key }}
Content-Type: application/json</pre>
                </li>
                <li style="margin-bottom: var(--space-3);"><strong>Body (JSON):</strong>
                    <pre style="background: var(--gray-900); color: #f9a8d4; padding: var(--space-4); border-radius: var(--radius-lg); margin-top: var(--space-2); font-size: 0.875rem; overflow-x: auto;">{
  "agent_slug": "seu-agente",
  "message": "Ol√°, quero agendar uma manicure",
  "session_id": "opcional-id-sessao"
}</pre>
                </li>
            </ol>

            <div style="background: linear-gradient(135deg, var(--primary-50), var(--rose-50)); padding: var(--space-4); border-radius: var(--radius-lg); margin-top: var(--space-4); border-left: 3px solid var(--primary-500);">
                <p style="color: var(--gray-700); font-size: 0.9375rem; margin: 0;">
                    <strong>üí° Dica:</strong> Use o <code style="background: white; padding: 2px 6px; border-radius: 4px;">session_id</code> para manter contexto entre mensagens da mesma conversa.
                </p>
            </div>
        </div>
        
        <div style="margin-top: var(--space-8); text-align: center;">
            <a href="{% url 'organizations:apikeys' %}" class="btn btn-success" style="padding: var(--space-4) var(--space-8);">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                </svg>
                Voltar para Minhas Keys
            </a>
        </div>
    </div>
    {% else %}
    <form method="post" class="form">
        {% csrf_token %}
        
        <div class="info-box" style="margin-bottom: var(--space-8);">
            <h3 class="info-box-title">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Para que serve a API Key?
            </h3>
            <p style="color: var(--gray-700); line-height: 1.8; margin-top: var(--space-4); font-size: 1rem;">
                A API Key permite que voc√™ <strong>conecte seus agentes de IA em ferramentas externas</strong> como n8n, Zapier, Make.com, ou sua pr√≥pria aplica√ß√£o. 
                Com ela, voc√™ pode enviar mensagens para os agentes e receber respostas, mantendo todas as conversas registradas aqui na plataforma.
            </p>
            
            <div style="background: linear-gradient(135deg, var(--primary-50), white); padding: var(--space-5); border-radius: var(--radius-xl); margin-top: var(--space-4); border-left: 3px solid var(--primary-500);">
                <h4 style="color: var(--gray-900); font-size: 0.9375rem; font-weight: 700; margin-bottom: var(--space-3);">
                    üîó Casos de Uso:
                </h4>
                <ul style="color: var(--gray-700); line-height: 1.8; margin-left: var(--space-6);">
                    <li>Integrar com WhatsApp via n8n</li>
                    <li>Conectar ao Telegram ou Discord</li>
                    <li>Criar chatbot no seu site</li>
                    <li>Automatizar atendimento em m√∫ltiplos canais</li>
                    <li>Integrar com CRM ou sistema pr√≥prio</li>
                </ul>
            </div>

            <div style="background: rgba(254, 243, 199, 0.3); padding: var(--space-4); border-radius: var(--radius-lg); margin-top: var(--space-4); border-left: 3px solid var(--warning);">
                <p style="color: var(--gray-700); font-size: 0.875rem; margin: 0;">
                    <strong>üîí Seguran√ßa:</strong> A chave ser√° exibida apenas uma vez. A chave dar√° acesso total aos agentes da organiza√ß√£o. Guarde em local seguro!
                </p>
            </div>
        </div>
        
        <div class="form-group">
            <label for="organization">Organiza√ß√£o *</label>
            <select name="organization" id="organization" required>
                <option value="">Selecione uma organiza√ß√£o...</option>
                {% for org in organizations %}
                <option value="{{ org.id }}">{{ org.name }}</option>
                {% endfor %}
            </select>
            <small class="form-helper">Selecione a organiza√ß√£o que ter√° acesso com esta chave</small>
        </div>
        
        <div class="form-group">
            <label for="name">Nome/Descri√ß√£o</label>
            <input type="text" name="name" id="name" placeholder="Ex: Integra√ß√£o n8n WhatsApp, API Mobile, etc.">
            <small class="form-helper">Opcional - ajuda a identificar onde esta chave est√° sendo usada</small>
        </div>
        
        <div style="display: flex; gap: var(--space-3); justify-content: flex-end; margin-top: var(--space-8); padding-top: var(--space-6); border-top: 2px solid var(--gray-100);">
            <a href="{% url 'organizations:apikeys' %}" class="btn btn-secondary">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                Cancelar
            </a>
            <button type="submit" class="btn btn-success">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                </svg>
                Gerar API Key
            </button>
        </div>
    </form>
    {% endif %}
</div>
{% endblock %}
