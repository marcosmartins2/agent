{% extends 'base.html' %}

{% block title %}Criar Chave API - PanDia{% endblock %}
{% block page_title %}Criar Chave API{% endblock %}

{% block content %}
<a href="{% url 'organizations:apikeys' %}" class="back-link">
    ‚Üê Voltar para Chaves API
</a>

{% if new_key %}
<div class="card" style="max-width: 800px; margin: 0 auto;">
    <div style="text-align: center; margin-bottom: 2rem;">
        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #fb923c, #f59e0b); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
            <svg width="40" height="40" fill="none" stroke="white" stroke-width="2.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
        </div>
        <h2 class="content-title">Chave API Criada com Sucesso!</h2>
        <p style="color: #ef4444; font-weight: 600; margin-top: 1rem;">‚ö†Ô∏è IMPORTANTE: Copie esta chave agora! Ela n√£o ser√° exibida novamente.</p>
    </div>
    
    <div style="background: var(--gray-900); color: #f9a8d4; padding: 1.5rem; border-radius: 12px; font-family: monospace; font-size: 1rem; letter-spacing: 1px; word-break: break-all; margin: 2rem 0; text-align: center;">
        {{ new_key }}
    </div>

    <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 12px; margin-top: 2rem;">
        <h4 style="color: var(--gray-900); font-size: 1.125rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
            </svg>
            Como usar no n8n
        </h4>
        
        <ol style="color: var(--gray-700); line-height: 1.8; margin-left: 1.5rem;">
            <li style="margin-bottom: 0.75rem;"><strong>No n8n:</strong> Adicione um n√≥ HTTP Request</li>
            <li style="margin-bottom: 0.75rem;"><strong>URL:</strong> <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;">{{ request.scheme }}://{{ request.get_host }}/api/chat/</code></li>
            <li style="margin-bottom: 0.75rem;"><strong>M√©todo:</strong> POST</li>
            <li style="margin-bottom: 0.75rem;"><strong>Cabe√ßalhos:</strong>
                <pre style="background: white; padding: 1rem; border-radius: 8px; margin-top: 0.5rem; font-size: 0.875rem; overflow-x: auto; border: 1px solid var(--gray-200);">Authorization: Bearer {{ new_key }}
Content-Type: application/json</pre>
            </li>
            <li style="margin-bottom: 0.75rem;"><strong>Corpo (JSON):</strong>
                <pre style="background: white; padding: 1rem; border-radius: 8px; margin-top: 0.5rem; font-size: 0.875rem; overflow-x: auto; border: 1px solid var(--gray-200);">{
  "agent_slug": "your-agent",
  "message": "Hello, I want to schedule an appointment",
  "session_id": "optional-session-id"
}</pre>
            </li>
        </ol>

        <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 3px solid #f59e0b;">
            <p style="color: #92400e; font-size: 0.9375rem; margin: 0;">
                <strong>üí° Dica:</strong> Use <code style="background: white; padding: 2px 6px; border-radius: 4px;">session_id</code> para manter contexto entre mensagens na mesma conversa.
            </p>
        </div>
    </div>
    
    <div style="margin-top: 2rem; text-align: center;">
        <a href="{% url 'organizations:apikeys' %}" class="btn btn-primary">
            Voltar para Minhas Chaves
        </a>
    </div>
</div>
{% else %}
<div class="card" style="max-width: 600px; margin: 0 auto;">
    <h2 class="content-title">Criar Nova Chave API</h2>
    <p class="content-subtitle">Gere uma chave API para integrar com sua aplica√ß√£o</p>
    
    <div style="background: #fef3c7; padding: 1.5rem; border-radius: 12px; margin: 2rem 0; border-left: 4px solid #f59e0b;">
        <h3 style="color: #92400e; font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            Para que serve uma Chave API?
        </h3>
        <p style="color: #92400e; line-height: 1.6; font-size: 0.9375rem;">
            A Chave API permite que voc√™ <strong>conecte seus agentes de IA a ferramentas externas</strong> como n8n, Zapier, Make.com ou sua pr√≥pria aplica√ß√£o. 
            Com ela, voc√™ pode enviar mensagens para os agentes e receber respostas, mantendo todas as conversas registradas na plataforma.
        </p>
    </div>

    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label class="form-label" for="name">Nome da Chave API</label>
            <input type="text" name="name" id="name" class="form-input" placeholder="Chave de Produ√ß√£o" required>
            <small class="form-helper" style="display: block; margin-top: 0.5rem; color: var(--gray-500); font-size: 0.875rem;">Escolha um nome descritivo para identificar esta chave</small>
        </div>
        
        <div class="form-group">
            <label class="form-label" for="organization">Organiza√ß√£o</label>
            <select name="organization" id="organization" class="form-select" required>
                <option value="">Selecione a organiza√ß√£o...</option>
                {% for org in organizations %}
                <option value="{{ org.id }}">{{ org.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div style="display: flex; gap: 0.75rem; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--gray-200);">
            <button type="submit" class="btn btn-primary">
                Gerar Chave API
            </button>
            <a href="{% url 'organizations:apikeys' %}" class="btn btn-secondary">
                Cancelar
            </a>
        </div>
    </form>
</div>
{% endif %}
{% endblock %}
